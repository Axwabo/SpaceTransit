name: build
author: Axwabo
description: build

inputs:
  image:
    description: The docker image to use
    required: true
  name:
    description: The name of the project
    required: true
  platform:
    description: The platform to build for
    required: true
  UNITY_LICENSE:
    required: true
  UNITY_EMAIL:
    required: true
  UNITY_PASSWORD:
    required: true

runs:
  using: composite
  steps:

    - name: Set HOME
      run: export HOME=/home/github
      shell: bash

    - uses: game-ci/unity-builder@v4.7.0
      env:
        UNITY_LICENSE: ${{ inputs.UNITY_LICENSE }}
        UNITY_EMAIL: ${{ inputs.UNITY_EMAIL }}
        UNITY_PASSWORD: ${{ inputs.UNITY_PASSWORD }}
      with:
        targetPlatform: ${{ inputs.platform }}
        customImage: ${{ inputs.image }}
        runAsHostUser: true

    - name: Copy
      shell: bash
      run: |
        mkdir -p bundle/${{ inputs.platform }}
        cp -r build/${{ inputs.platform }} bundle

    - name: Clean Up
      working-directory: bundle/${{ inputs.platform }}
      shell: bash
      run: |
        rename ${{ inputs.platform }} ${{ inputs.name }} ${{ inputs.platform }}*
        rm -r *DoNotShip
